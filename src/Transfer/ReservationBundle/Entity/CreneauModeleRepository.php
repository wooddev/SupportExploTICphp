<?php

namespace Transfer\ReservationBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * CreneauModeleRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CreneauModeleRepository extends EntityRepository
{
    public function findDisponibles(){
        $qb = $this->getEntityManager()->createQueryBuilder();
        
        $subqb = $this->getEntityManager()->createQueryBuilder();
        
        $subqb  ->select('cm0')
                ->from('TransferReservationBundle:CreneauModele','cm0 ')
                ->leftjoin('cm0.creneauxPrefs', 'cp')
                ->groupBy('cm0')
                ->having('count(cp)>0')
                ;

        $qb ->select('cm')
            ->from('TransferReservationBundle:CreneauModele','cm ')
            ->where($qb->expr()->notin('cm', $subqb->getDQL()))
            ;      
        
        return $qb;                
    }

    
    public function find($id){
        return $this->getEntityManager()
                ->createQuery('
                SELECT cm
                FROM TransferReservationBundle:CreneauModele cm
                WHERE cm.id = :id               
                ')
                ->setParameter(':id',$id)
                ->getResult();
    }
    
    public function findByNomStatut($nomStatut){
        return $this->getEntityManager()
                ->createQuery('
                    SELECT cm
                    FROM TransferReservationBundle:CreneauModele cm
                    JOIN cm.statut st
                    WHERE st.nom = :nomStatut
                    ')
                ->setParameter(':nomStatut',$nomStatut)
                ->getResult();
    }
}
