<?php

namespace Transfer\ReservationBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * CreneauRdvRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CreneauRdvRepository extends EntityRepository
{
    public function findByRecherche($rdvRecherche){

        $query = $this->getEntityManager()->createQuery(
        "SELECT cr
        FROM TransferReservationBundle:CreneauRdv cr
        JOIN cr.typePoste t
        AND Disponibilite <> 0
        AND t.id = :posteId
        AND cr.heureDebut BETWEEN :min AND :max
        ");
        // Construction de l'interval de temps de recherche
        $interval = new \DateInterval('PT30M'); //PÃ©riode de Temps de 30 min
        $min = clone $rdvRecherche->getHeureDebut();
        $min->sub($interval);
        $max = clone $rdvRecherche->getHeureDebut();
 
        $max->add($interval);
        //
        $query->setParameters(array(
            'posteId'=> $rdvRecherche->getTypePoste()->getId(),
            'min'=> $min,
            'max'=> $max
                ));
        
        return $query->getResult();
    }
}
